je_zandism_main = {
	icon = "gfx/interface/icons/religion_icons/zandism.dds"

	group = je_group_tsr_content
	
	scripted_button = incarcerate_zand_button

	is_shown_when_inactive = {
		c:PER ?= this
		NOR = { 
			has_law = law_type:law_state_religion
			has_law = law_type:law_state_atheism			
			has_law = law_type:law_theocracy		
		}
	}

	possible = {
		OR = {
			has_journal_entry = je_constitutional_reformation
			any_scope_character = {
				AND = {
					OR = {
						is_ruler = yes
						interest_group = {
							is_in_government = yes
						}
					}
					OR = {
						has_ideology = ideology:ideology_persian_constitutionalist
						has_ideology = ideology:ideology_reformer
						has_ideology = ideology:ideology_humanitarian_royalist
						has_ideology = ideology:ideology_liberal_leader
					}
				}
			}
		}
		custom_tooltip = {
			text = zand_appears_tt
			any_scope_character = {
				has_variable = mohammad_zand
			}
		}
		OR = {
			ig:ig_devout = {
				ig_approval <= -10
				is_marginal = no
				is_in_government = no
			}
			ig:ig_devout = {
				is_in_government = yes
				leader = {
					OR = {
						has_ideology = ideology:ideology_persian_constitutionalist
						has_ideology = ideology:ideology_reformer
						has_ideology = ideology:ideology_bahai #in case you somehow made Bab ig leader
					}
				}
			}
		}
		any_scope_state = {
			is_incorporated = yes
			population >= 1000000
			state_region = { 
				is_homeland = cu:persian
			}
			OR = {
				average_sol <= 10
				turmoil > 0.15
			}
		}
		is_subject = no
	}

	immediate = {
		set_zandism_vars = yes
		set_variable = { name = zandism_je_var value = 0 }
		trigger_event = { id = zandism_events.6 days = 1 popup = yes }
	}

	on_weekly_pulse = {
		effect = {
			calculate_zandism_progress = yes
		}
	}

	on_monthly_pulse = {
		effect = {
			add_zandism_progress = yes
		}
	}
	
	complete = {
		custom_tooltip = {
			text = PER_zandism_0_tt
			var:zandism_je_var <= 0
			has_variable = je_zandism_start
		}
		custom_tooltip = {
			text = no_zand_tt #Mohammad Zand is either exiled or dead
			NOT = {
				any_scope_character = {
					has_variable = mohammad_zand
				}
			}
		}
	}

	on_complete = {
		clear_zandism_vars = yes
		trigger_event = { id = BRZ_populism.3 popup = yes }
	}

	fail = {
		custom_tooltip = {
			text = PER_zandism_100_tt
			var:zandism_je_var >= 100
			has_variable = je_zandism_start
		}
	}

	on_fail = {
		clear_zandism_vars = yes
		trigger_event = { id = zandism_events.1 popup = yes }
		show_as_tooltip = {
			add_journal_entry = {
				type = je_rise_of_zandism
			}
		}
	}

	current_value = {
		value = root.var:zandism_je_var
	}

	goal_add_value = {
		add = 100
	}
	
	invalid = {
		has_law = law_type:law_state_atheism
	}

	weight = 100

	progressbar = yes

	should_be_pinned_by_default = yes
}

je_rise_of_zandism = {
	icon = "gfx/interface/icons/event_icons/event_revolt.dds"
	group = je_group_tsr_content
	
	on_monthly_pulse = {
		random_events = {
			5 = 0
			1 = zandism_events.2
		}
	}

	complete = {
		NOT = {
			any_scope_state = {
				has_modifier = zandism_spreading
			}
		}
	}

	fail = {
		any_scope_state = {
			has_modifier = zandism_spreading
			count >= 4
			turmoil >= 0.15
		}
		NOT = { 
			has_law = law_type:law_state_atheism
		}
	}
	
	on_fail = {
		trigger_event = {
			id = zandism_events.3
		}
	}
	
	invalid = {
		has_law = law_type:law_state_atheism
	}

	transferable = no
	weight = 10000
	should_be_pinned_by_default = yes
}

je_zandi_rebellion = {
	icon = "gfx/interface/icons/event_icons/event_revolt.dds"
	group = je_group_tsr_content

	complete = {
		custom_tooltip = {
			text = islamic_state_destroyed
			hidden_trigger = {
				NOT = {
					exists = c:ZNI
				}
			}
		}
	}

	immediate = {
		c:ZNI = {
			save_scope_as = islamic_state_scope
		}
	}
	
	on_complete = {
		trigger_event = { id = zandism_events.4 days = 0 }
		hidden_effect = {
			remove_modifier = zandi_rebellion_modifier
		}
	}

	fail = {
		exists = c:ZNI
		has_truce_with = c:ZNI
	}

	on_fail = {
		if = {
			limit = { has_journal_entry = je_eclipse_of_persia }
			post_notification = persia_eclipse_point_add
			change_variable = {
				name = persia_eclipse_var
				add = 10
			}
		}

		hidden_effect = {
			remove_modifier = zandi_rebellion_modifier
			c:ZNI = {
				remove_modifier = zandi_rebellion_modifier
			}
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes

	transferable = no
}

je_zandi_revolution = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_tsr_content

	complete = {
		OR = {
			custom_tooltip = {
				text = safavids_destroyed
				hidden_trigger = {
					NOT = {
						exists = c:PER
					}
				}
			}
			AND = {
				exists = c:PER
				has_truce_with = c:PER		
			}
		}
		
	}

	immediate = {
		c:PER = {
			save_scope_as = per_scope
		}
	}

	on_complete = {
		trigger_event = { id = zandism_events.5 days = 0 }
		custom_tooltip = {
			text = rebellion_effects_remove
			remove_modifier = zandi_rebellion_modifier
			every_interest_group = {
				limit = {
					has_modifier = zandi_revolution_modifier
				}
				remove_modifier = zandi_revolution_modifier
			}
		}
		
	}

	fail = {
		NOT = {
			exists = c:ZNI
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes

	transferable = no
}