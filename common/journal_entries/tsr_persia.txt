je_persian_renaissance = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	group = je_group_tsr_content

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}
	
	scripted_button = persian_renaissance_science_philosophy
	scripted_button = persian_renaissance_historical_sites
	scripted_button = persian_renaissance_literature
	scripted_button = persian_renaissance_architecture
	scripted_button = persian_renaissance_textile_arts
	#scripted_button = persian_renaissance_romantic_nationalism

	on_complete = {
		
	}
	
	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = { has_variable = fire_temple_vandalized }
					any_scope_building = {
						is_building_type = building_yazd_atash_beram
						is_under_construction = yes
					}
				}
				random_list = {
					7 = { }
					3 = {
						set_variable = fire_temple_vandalized
						trigger_event = { id = persian_flavor.2 }
					}
				}
			}
		}
	}
	
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = { has_global_variable = ctesiphon_finished }
					any_scope_building = {
						is_building_type = building_ctesiphon
						level >= 1
					}
				}
				trigger_event = { id = persian_renaissance.3 }
			}
			if = {
				limit = {
					NOT = { has_global_variable = susa_finished }
					any_scope_building = {
						is_building_type = building_susa
						level >= 1
					}
				}
				trigger_event = { id = persian_renaissance.4 }
			}
			if = {
				limit = {
					NOT = { has_global_variable = persepolis_finished }
					any_scope_building = {
						is_building_type = building_persepolis
						level >= 1
					}
				}
				trigger_event = { id = persian_renaissance.5 }
			}
			if = {
				limit = {
					NOT = { has_global_variable = fire_temple_finished }
					any_scope_building = {
						is_building_type = building_yazd_atash_beram
						level >= 1
					}
				}
				trigger_event = { id = persian_renaissance.6 }
			}
		}
	}

	current_value = {
		value = var:persian_renaissance_var
	}

	goal_add_value = {
		add = 6
	}

	progressbar = yes

	timeout = 14600

	weight = 100
	should_be_pinned_by_default = yes
}

je_rise_of_bahaism = {
	icon = "gfx/interface/icons/event_icons/event_religion.dds"
	group = je_group_tsr_content
	
	complete = {
		custom_tooltip = {
			text = bab_popularity_tt
			any_scope_character = {
				has_variable = bab
				NOT = { has_modifier = modifier_bab_popularity }
			}
		}
	}
	
	on_complete = {
		trigger_event = { id = persian_flavor.16 } #The Waning of Babism Movement
	}
		
	on_monthly_pulse = {
		random_events = {
			100 = 0
			10 = persian_flavor.14 # Clergy unrest
			#10 = Battle of Fort Tabarsi event
		}
		effect = {
			if = {
				limit = {
					any_scope_character = {
						has_template = per_bab_character_template
						popularity <= 35
					}
				}
				random_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:persian
						}
					}
					convert_population = {
						target = rel:bahai
						value = 0.0005
					}
				}
			}
			else_if = {
				limit = {
					any_scope_character = {
						has_template = per_bab_character_template
						popularity > 35
						popularity < 50
					}
				}
				random_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:persian
						}
					}
					convert_population = {
						target = rel:bahai
						value = 0.001
					}
				}
			}
			else_if = {
				limit = {
					any_scope_character = {
						has_template = per_bab_character_template
						popularity >= 50
						popularity < 75
					}
				}
				random_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:persian
						}
					}
					convert_population = {
						target = rel:bahai
						value = 0.0015
					}
				}
			}
			else_if = {
				limit = {
					any_scope_character = {
						has_template = per_bab_character_template
						popularity >= 75
						popularity < 100
					}
				}
				random_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:persian
						}
					}
					convert_population = {
						target = rel:bahai
						value = 0.002
					}
				}
			}
			else_if = {
				limit = {
					any_scope_character = {
						has_template = per_bab_character_template
						popularity >= 100
					}
				}
				random_scope_state = {
					limit = {
						state_region = {
							is_homeland = cu:persian
						}
					}
					convert_population = {
						target = rel:bahai
						value = 0.0025
					}
				}
			}
		}
	}

	weight = 100
	should_be_pinned_by_default = yes
}

je_eclipse_of_persia = {
	icon = "gfx/interface/icons/event_icons/event_eclipse.dds"
	group = je_group_tsr_content

	is_shown_when_inactive = {
		c:PER ?= this
		has_law = law_type:law_monarchy
		OR = {
			has_technology_researched = nationalism
			has_technology_researched = egalitarianism
		}
	}

	possible = {
		calc_true_if = {
			amount >= 2
			any_state = {
				state_region = { is_homeland = cu:persian }
				NOR = { 
					owner = ROOT 
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			any_scope_state = {
				count >= 3
				is_incorporated = yes
				OR = {
					turmoil >= 0.2
					devastation >= 0.2
				}
			}
			is_losing_power_rank = yes
			has_technology_researched = political_agitation
		}
	}

	immediate = {
		set_variable = {
			name = persia_eclipse_var
			value = 0
		}
		random_law = {
			limit = { type = law_type:law_monarchy }
			save_scope_as = monarchy_scope
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		custom_tooltip = {
			text = persia_eclipse_criteria
		}
	}

	fail = {
		custom_tooltip = {
			text = persia_abolished_monarchy_tt
			has_variable = persia_eclipse_abolished_monarchy
		}
		any_scope_state = {
			count = all
			turmoil < 0.1
		}
	}

	on_complete = {
		#trigger_event = { id =  } Dead Man of Asia
	}

	current_value = {
		value = var:persia_eclipse_var
	}

	goal_add_value = {
		add = 5
	}
	
	progressbar = yes

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_subject }
					is_subject = yes
				}
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
				set_variable = persia_eclipse_subject
			}
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_loans }
					taking_loans = yes
				}
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
				set_variable = persia_eclipse_loans
			}
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_lost_standing }
					country_rank != rank_value:great_power
				}
				set_variable = persia_eclipse_lost_standing
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_lost_india 
					}
					has_variable = failed_hindustani_uprising
				}
				set_variable = persia_eclipse_lost_india
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_lost_arabia
					}
					has_variable = failed_arab_revolt
				}
				set_variable = persia_eclipse_lost_arabia
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_european_enroachment
					}
					any_scope_state = {
						is_incorporated = yes
						OR = {
							state_region = { is_homeland = cu:persian }
							state_region = { is_homeland = cu:caspian }
							state_region = { is_homeland = cu:luri }
							state_region = { is_homeland = cu:kurdish }
							state_region = { is_homeland = cu:azerbaijani }
							state_region = { is_homeland = cu:pashtun }
							state_region = { is_homeland = cu:tajik }
							state_region = { is_homeland = cu:hazara }
							state_region = { is_homeland = cu:baluchi }
						}
						any_neighbouring_state = {
							owner = {
								any_primary_culture = {
									OR = {
										has_discrimination_trait = south_european_heritage
										has_discrimination_trait = eastern_european_heritage
										has_discrimination_trait = western_european_heritage
									}
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_european_enroachment
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_homelands
					}
					NOT = {
						any_state = {
							state_region = { is_homeland = cu:persian }
							NOR = { 
								owner = ROOT 
								owner = {
									is_subject_of = ROOT
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_homelands
				post_notification = persia_eclipse_point_remove
				change_variable = {
					name = persia_eclipse_var
					subtract = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_no_europeans
					}
					has_variable = persia_eclipse_european_enroachment
					NOT = {
						any_state = {
							is_incorporated = yes
							OR = {
								state_region = { is_homeland = cu:persian }
								state_region = { is_homeland = cu:caspian }
								state_region = { is_homeland = cu:luri }
								state_region = { is_homeland = cu:kurdish }
								state_region = { is_homeland = cu:azerbaijani }
								state_region = { is_homeland = cu:pashtun }
								state_region = { is_homeland = cu:tajik }
								state_region = { is_homeland = cu:hazara }
								state_region = { is_homeland = cu:baluchi }
							}
							any_neighbouring_state = {
								owner = {
									any_primary_culture = {
										OR = {
											has_discrimination_trait = south_european_heritage
											has_discrimination_trait = eastern_european_heritage
											has_discrimination_trait = western_european_heritage
										}
									}
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_no_europeans
				remove_variable = persia_eclipse_european_enroachment
				post_notification = persia_eclipse_point_remove
				change_variable = {
					name = persia_eclipse_var
					subtract = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_failed_reformation
					}
					has_variable = failed_reformation
				}
				set_variable = persia_eclipse_failed_reformation
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
		}
	}

	transferable = no
	weight = 10000
	should_be_pinned_by_default = yes
	can_revolution_inherit = yes
}

je_constitutional_reformation = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	group = je_group_tsr_content
	
	scripted_button = edict_of_yazd_button
	
	immediate = {
		set_variable = {
			name = constitutional_reformation_var
			value = 0
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		NOR = {
			has_law = law_type:law_autocracy
			has_law = law_type:law_oligarchy
			has_law = law_type:law_landed_voting
			has_law = law_type:law_state_religion
			has_law = law_type:law_legacy_slavery
			has_law = law_type:law_debt_slavery
			has_law = law_type:law_slave_trade
			has_law = law_type:law_no_womens_rights
			has_law = law_type:law_no_workers_rights
		}
		ig:ig_intelligentsia = {
			is_marginal = no
			is_in_government = yes
		}
		ig:ig_landowners = {
			is_in_government = no
			ig_clout < 0.15
		}
		ig:ig_devout = {
			OR = {
				AND = {
					is_in_government = no
					ig_clout < 0.15
				}
				leader = {
					NOR = {
						has_ideology = ideology:ideology_theocrat
						has_ideology = ideology:ideology_traditionalist
						has_ideology = ideology:ideology_fascist
						has_ideology = ideology:ideology_authoritarian
					}
				}
			}
		}
	}
	
	on_complete = {
		trigger_event = { id = persian_flavor.11 }
		if = {
			limit = { not = { has_variable = clerical_conflict } }
			ig:ig_devout = {
				remove_ideology = ideology_shiite_moralist
				add_ideology = ideology_constitutional_moralist
			}
		}
	}

	fail = {
		OR = {
			highest_secession_progress > 0.9
			custom_tooltip = {
				text = zandi_rebellion_begins_tt
				exists = c:ZNI
				has_variable = zandi_rebellion_start
			}
		}
	}
	
	on_fail = {
		set_variable = failed_reformation
		trigger_event = { id = persian_flavor.31 }
		#Regressed democratic laws
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_state_religion
                }
            }
            activate_law = law_type:law_state_religion
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_racial_segregation
                }
            }
            activate_law = law_type:law_racial_segregation
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_autocracy
                }
            }
            activate_law = law_type:law_autocracy
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_national_supremacy
                }
            }
            activate_law = law_type:law_national_supremacy
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_outlawed_dissent
                }
            }
            activate_law = law_type:law_outlawed_dissent
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_national_guard
                }
            }
            activate_law = law_type:law_national_guard
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_hereditary_bureaucrats
                }
            }
            activate_law = law_type:law_hereditary_bureaucrats
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_religious_schools
                }
            }
            activate_law = law_type:law_religious_schools
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_tenant_farmers
                }
            }
            activate_law = law_type:law_tenant_farmers
        }
		if = {
            limit = {
                NOT = {
                    has_law = law_type:law_no_womens_rights
                }
            }
            activate_law = law_type:law_no_womens_rights
        }
		if = {
			limit = {
				ig:ig_devout = {
					has_modifier = unislamic_constitution
				}
			}
			remove_modifier = unislamic_constitution
		}
	}
	
	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					NOR = {
						has_law = law_type:law_autocracy
						has_law = law_type:law_oligarchy
						has_law = law_type:law_landed_voting
						has_law = law_type:law_state_religion
						has_law = law_type:law_legacy_slavery
						has_law = law_type:law_debt_slavery
						has_law = law_type:law_slave_trade
						has_law = law_type:law_no_womens_rights
						has_law = law_type:law_no_workers_rights
					}
					ig:ig_intelligentsia = {
						is_marginal = no
						is_in_government = yes
					}
					ig:ig_landowners = {
						is_in_government = no
						ig_clout < 0.15
					}
					ig:ig_devout = {
						OR = {
							AND = {
								is_in_government = no
								ig_clout < 0.15
							}
							leader = {
								NOR = {
									has_ideology = ideology:ideology_theocrat
									has_ideology = ideology:ideology_traditionalist
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_authoritarian
								}
							}
						}
					}
				}
				change_variable = {
					name = constitutional_reformation_var
					add = 1
				}
            }
		}
		random_events = {
            100 = 0
            10 = persian_flavor.26
            10 = persian_flavor.27
            10 = persian_flavor.28
            10 = persian_flavor.29
            10 = persian_flavor.30
        }
	}
	
	current_value = {
		value = var:constitutional_reformation_var
	}

	goal_add_value = {
		add = 120
	}

	transferable = no
	weight = 10000
	should_be_pinned_by_default = yes
}