namespace = opium_events

opium_events.1 = {
	type = country_event
	event_image = {
		video = "southamerica_factory_opening"
	}

	duration = 3

	placement = scope:opium_state

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_trade.dds"

	title = opium_events.1.t
	desc = opium_events.1.d
	flavor = opium_events.1.f
	
	trigger = {
		c:PER ?= this
		year >= 1845
		any_scope_building = {
			is_building_type = building_opium_plantation
			cash_reserves_ratio > 0.5
			weekly_profit > 0
			occupancy >= 0.75
			level >= 10
		}
		any_market = {
			NOT = { owner = root }
			any_trade_route = {
				exporter.owner = root
				goods = g:opium
			}
			any_scope_country = {
				country_is_in_europe = yes
				has_law = law_type:law_no_substances_regulation
				any_scope_state = { is_coastal = yes }
				any_primary_culture = {
					NOT = {
						has_cultural_obsession = opium
					}
					OR = {
						has_discrimination_trait = western_european_heritage
						has_discrimination_trait = south_european_heritage
					}
				}
			}
		}
		NOT = { has_variable = opium_war_prelude }
	}

	immediate = {
		set_variable = opium_war_prelude
		random_scope_state = {
			limit = {
				any_scope_building = {
					is_building_type = building_opium_plantation
					cash_reserves_ratio > 0.5
					weekly_profit > 0
					occupancy >= 0.75
					level >= 10
				}
			}
			save_scope_as = opium_state
			random_scope_building = {
				limit = {
					is_building_type = building_opium_plantation
					cash_reserves_ratio > 0.5
					weekly_profit > 0
					occupancy >= 0.75
					level >= 10
				}
				save_scope_as = opium_building
			}
		}
		random_market = {
			limit = {
				NOT = { owner = root }
				any_trade_route = {
					exporter.owner = root
					goods = g:opium
				}
				any_scope_country = {
					has_law = law_type:law_no_substances_regulation
					country_is_in_europe = yes
					any_scope_state = { is_coastal = yes }
					any_primary_culture = {
						NOT = {
							has_cultural_obsession = opium
						}
						OR = {
							has_discrimination_trait = western_european_heritage
							has_discrimination_trait = south_european_heritage
						}
					}
				}
			}
			every_scope_country = {
				limit = { 
					country_is_in_europe = yes 
					any_scope_state = { is_coastal = yes }
					has_law = law_type:law_no_substances_regulation
				}
				save_scope_as = opium_addict_country
				random_primary_culture = {
					limit = {
						NOT = { has_cultural_obsession = opium }
						OR = {
							has_discrimination_trait = western_european_heritage
							has_discrimination_trait = south_european_heritage
						}
					}
					save_scope_as = opium_addict_culture
				}
			}
		}
	}

	option = {
		name = opium_events.1.a
		default_option = yes
		add_modifier = {
			name = opium_production_modifier
			months = normal_modifier_time
		}
		ai_chance = {
			base = 0
		}
	}
	
	option = {
		name = opium_events.1.b
		every_market = {
			limit = {
				NOT = { owner = root }
				any_trade_route = {
					exporter.owner = root
					goods = g:opium
				}
				any_scope_country = {
					limit = { 
						country_is_in_europe = yes 
						any_scope_state = { is_coastal = yes }
						has_law = law_type:law_no_substances_regulation
					}
					any_primary_culture = {
						NOT = {
							has_cultural_obsession = opium
						}
						OR = {
							has_discrimination_trait = western_european_heritage
							has_discrimination_trait = south_european_heritage
						}
					}
				}
			}
			every_scope_country = {
				limit = { 
					country_is_in_europe = yes 
					any_scope_state = { is_coastal = yes }
					has_law = law_type:law_no_substances_regulation
				}
				every_primary_culture = {
					limit = {
						NOT = { has_cultural_obsession = opium }
						OR = {
							has_discrimination_trait = western_european_heritage
							has_discrimination_trait = south_european_heritage
						}
					}
					add_cultural_obsession = opium
				}
			}
		}
		add_modifier = {
			name = opium_exporter_modifier
			months = normal_modifier_time
		}
		ai_chance = {
			base = 1000
		}
	}
}
