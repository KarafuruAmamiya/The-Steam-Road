je_eclipse_of_persia = {
	icon = "gfx/interface/icons/event_icons/event_eclipse.dds"
	is_shown_when_inactive = {		c:PER ?= this		has_law = law_type:law_monarchy
		OR = {
			has_technology_researched = nationalism
			has_technology_researched = egalitarianism
		}	}	possible = {
		calc_true_if = {
			amount >= 2
			any_state = {
				state_region = { is_homeland = cu:persian }
				NOR = { 
					owner = ROOT 
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			any_scope_state = {
				count >= 3
				is_incorporated = yes
				OR = {
					turmoil >= 0.2
					devastation >= 0.2
				}
			}
			is_losing_power_rank = yes
			has_technology_researched = political_agitation
		}	}

	immediate = {
		random_law = {
			limit = { type = law_type:law_monarchy }
			save_scope_as = monarchy_scope
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		custom_tooltip = {
			text = persia_eclipse_criteria
		}
	}

	fail = {
		custom_tooltip = {
			text = persia_abolished_monarchy_tt
			has_variable = persia_eclipse_abolished_monarchy
		}
		any_scope_state = {
			count = all
			turmoil < 0.1
		}
	}

	on_complete = {
		#trigger_event = { id =  } Dead Man of Asia
	}

	current_value = {
		value = var:persia_eclipse_var
	}

	goal_add_value = {
		add = 5
	}
	
	progressbar = yes

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_subject }
					is_subject = yes
				}
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
				set_variable = persia_eclipse_subject
			}
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_loans }
					taking_loans = yes
				}
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
				set_variable = persia_eclipse_loans
			}
			if = {
				limit = {
					NOT = { has_variable = persia_eclipse_lost_standing }
					country_rank != rank_value:great_power
				}
				set_variable = persia_eclipse_lost_standing
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_lost_india 
					}
					has_variable = failed_hindustani_uprising
				}
				set_variable = persia_eclipse_lost_india
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_lost_arabia
					}
					has_variable = failed_arab_revolt
				}
				set_variable = persia_eclipse_lost_arabia
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_european_enroachment
					}
					any_scope_state = {
						is_incorporated = yes
						OR = {
							state_region = { is_homeland = cu:persian }
							state_region = { is_homeland = cu:caspian }
							state_region = { is_homeland = cu:luri }
							state_region = { is_homeland = cu:kurdish }
							state_region = { is_homeland = cu:azerbaijani }
							state_region = { is_homeland = cu:pashtun }
							state_region = { is_homeland = cu:tajik }
							state_region = { is_homeland = cu:hazara }
							state_region = { is_homeland = cu:baluchi }
						}
						any_neighbouring_state = {
							owner = {
								any_primary_culture = {
									OR = {
										has_discrimination_trait = south_european_heritage
										has_discrimination_trait = eastern_european_heritage
										has_discrimination_trait = western_european_heritage
									}
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_european_enroachment
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_homelands
					}
					NOT = {
						any_state = {
							state_region = { is_homeland = cu:persian }
							NOR = { 
								owner = ROOT 
								owner = {
									is_subject_of = ROOT
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_homelands
				post_notification = persia_eclipse_point_remove
				change_variable = {
					name = persia_eclipse_var
					subtract = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_no_europeans
					}
					has_variable = persia_eclipse_european_enroachment
					NOT = {
						any_state = {
							is_incorporated = yes
							OR = {
								state_region = { is_homeland = cu:persian }
								state_region = { is_homeland = cu:caspian }
								state_region = { is_homeland = cu:luri }
								state_region = { is_homeland = cu:kurdish }
								state_region = { is_homeland = cu:azerbaijani }
								state_region = { is_homeland = cu:pashtun }
								state_region = { is_homeland = cu:tajik }
								state_region = { is_homeland = cu:hazara }
								state_region = { is_homeland = cu:baluchi }
							}
							any_neighbouring_state = {
								owner = {
									any_primary_culture = {
										OR = {
											has_discrimination_trait = south_european_heritage
											has_discrimination_trait = eastern_european_heritage
											has_discrimination_trait = western_european_heritage
										}
									}
								}
							}
						}
					}
				}
				set_variable = persia_eclipse_no_europeans
				remove_variable = persia_eclipse_european_enroachment
				post_notification = persia_eclipse_point_remove
				change_variable = {
					name = persia_eclipse_var
					subtract = 1
				}
			}
			if = {
				limit = {
					NOT = { 
						has_variable = persia_eclipse_failed_reformation
					}
					has_variable = failed_reformation
				}
				set_variable = persia_eclipse_failed_reformation
				post_notification = persia_eclipse_point_add
				change_variable = {
					name = persia_eclipse_var
					add = 1
				}
			}
		}
	}

	transferable = no
	weight = 10000
	should_be_pinned_by_default = yes
}

je_constitutional_reformation = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	complete = {
		NOR = {
			has_law = law_type:law_autocracy
			has_law = law_type:law_oligarchy
			has_law = law_type:law_landed_voting
			has_law = law_type:law_state_religion
			has_law = law_type:law_denominational_exclusion
			has_law = law_type:law_legacy_slavery
			has_law = law_type:law_debt_slavery
			has_law = law_type:law_slave_trade
			has_law = law_type:law_serfdom
			has_law = law_type:law_tenant_farmers
			has_law = law_type:law_no_womens_rights
			has_law = law_type:law_religious_schools
			has_law = law_type:law_no_schools
		}
		ig:ig_intelligentsia = {
			is_marginal = no
			is_in_government = yes
		}
	}
	
	on_complete = {
		trigger_event = { id = persian_flavor.11 }
	}

	fail = {
		OR = {
			custom_tooltip = {
				text = zandi_rebellion_start_tt
				has_variable = zandi_rebellion_start
			}
			any_interest_group = {
				is_powerful = yes
				law_stance = {
					law = law_type:law_council_republic
					value > neutral
				}
			}
		}
	}
	
	timeout = 7300
	
	on_fail = {
		set_variable = failed_reformation
	}
	
	on_timeout = {
		set_variable = failed_reformation
	}

	transferable = no
	weight = 10000
	should_be_pinned_by_default = yes
}