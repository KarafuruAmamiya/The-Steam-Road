# This is executed last among all history
GLOBAL = {
	# State traits
	every_state = { # We have to do this because "has_state_trait" only works on state scopes, not state regions.
		if = {
			limit = {
				state_region = s:STATE_KHUZESTAN
			}
			state_region = { remove_state_trait = state_trait_zagros_mountains }
		}
		if = {
			limit = {
				state_region = s:STATE_EQUATORIA # South Sudan
			}
			state_region = { add_state_trait = state_trait_nile_river }
		}
		if = { # to stop MAPI stacking
			limit = {
				state_region = s:STATE_DIYARBAKIR
			}
			state_region = { remove_state_trait = state_trait_tigris_river }
		}
		if = {
			limit = {
				OR = {
					state_region = s:STATE_BAGHDAD
					state_region = s:STATE_BASRA
					state_region = s:STATE_NASIRIYA
				}
			}
			state_region = { remove_state_trait = state_trait_euphrates_river }
		}
		if = {
			limit = {
				OR = {
					state_region = s:STATE_CIRCARS
					state_region = s:STATE_HYDERABAD
				}
			}
			state_region = { remove_state_trait = state_trait_krishna_river }
		}
		if = {
			limit = {
				state_region = s:STATE_ARMENIA
			}
			state_region = { add_state_trait = state_trait_caucasus_mountains }
		}
		if = {
			limit = {
				state_region = s:STATE_KHIVA
			}
			state_region = { remove_state_trait = state_trait_caspian_sea }
		}
	}
	every_country = {
		add_taxed_goods = g:services
	}
	every_country = {
		limit = {
			has_modifier = land_redistribution_modifier
			has_modifier = land_redistribution_compensation_modifier
		}
		remove_modifier = land_redistribution_modifier
		remove_modifier = land_redistribution_compensation_modifier
	}
	every_country = {
		limit = {
			NOR = {
				has_law = law_type:law_serfdom
				has_law = law_type:law_feudalism
				c:PER ?= this
			}
		}
		ig:ig_landowners = { 
			remove_ideology = ideology_stratocratic
			add_ideology = ideology_modern_stratocratic
		}
	}
	every_country = {
		limit = {
			NOR = {
				has_law = law_type:law_chiefdom
				has_law = law_type:law_monarchy
				has_law = law_type:law_theocracy
			}
		}
		ig:ig_intelligentsia = { 
			remove_ideology = ideology_constitutionalist
			add_ideology = ideology_republican
		}
		ig:ig_landowners = {
			remove_ideology = ideology_paternalistic
			add_ideology = ideology_republican_paternalistic
		}
		ig:ig_petty_bourgeoisie = {
			remove_ideology = ideology_constitutionalist
			add_ideology = ideology_republican
		}
	}
	every_country = {
		limit = { 
			NOT = { has_law = law_type:law_slavery_banned }
		}
		ig:ig_landowners = { add_ideology = ideology_pro_slavery }
	}
	
	# Jack the ripper, prevents the event from happening every game

	every_country = {
		if = {
			limit = {
				is_player = yes
			}
		}
		random_list = {
			1 = { set_variable = var_jack_ripper_possible }
			9 = {
				#Nothing Happens
			}
		}
	}
	set_global_variable = {
		name = number_of_mega_earthquakes
		value = 0
	}

	set_global_variable = {
		name = number_of_mega_floods
		value = 0
	}
	
	set_global_variable = {
		name = number_of_mega_eruptions
		value = 0
	}
	
	s:STATE_MARYLAND = {
        set_variable = {
            name = district_of_columbia
            value = yes
        }
	}
	
	every_country = {
		limit = { 
			OR = {
				country_is_in_middle_east = yes 
				gunpowder_empire_trigger = yes
			}
		}
        trigger_event = {
            id = lorebox.1
            days = 1
        }
    }
	
	every_country = {
		limit = { 
			country_is_in_europe = yes 
			gunpowder_empire_trigger = no
		}
        trigger_event = {
            id = lorebox.2
            days = 1
        }
    }
	
	every_country = {
		limit = { 
			OR = {
				country_is_in_east_asia = yes
				country_is_in_central_asia = yes
				country_is_in_southeast_asia = yes
			}
		}
        trigger_event = {
            id = lorebox.3
            days = 1
        }
    }
	
	every_country = {
		limit = { 
			OR = {
				country_is_in_north_america = yes
				country_is_in_central_america = yes
				country_is_in_south_america = yes
			}
		}
        trigger_event = {
            id = lorebox.4
            days = 1
        }
    }
	
	c:PER = {
		every_scope_state = {
            limit = {
				is_incorporated = yes
                any_scope_pop = {
					religion = rel:zoroastrian
				}
            }
            add_modifier = zoroastrian_persecution
        }
		every_scope_state = {
			limit = {
				state_is_in_india = yes
            }
			set_variable = hindustani_subject_state
		}
	}
	
	c:IBE = {
		every_scope_state = {
            limit = {
                OR = {
                    state_region = s:STATE_PORTO
                    state_region = s:STATE_ESTREMADURA 
					state_region = s:STATE_BEIRA
					state_region = s:STATE_ALENTEJO
					state_region = s:STATE_ARAGON
					state_region = s:STATE_VALENCIA
					state_region = s:STATE_CATALONIA
                }
            }
            add_radicals_in_state = {
                value = medium_radicals
                culture = cu:portuguese
            }
            add_radicals_in_state = {
                value = very_large_radicals
                culture = cu:catalan
            }
        }
	}
	
	c:AKN = {
		every_scope_state = {
            limit = {
				is_capital = no
				NOT = { state_region = s:STATE_KARS }
                state_region = {
					is_homeland = cu:kurdish
				}
            }
            add_modifier = {
				name = kurdish_autonomy
				months = -1
			}
        }
	}
	
	every_country = {
		limit = {
			NOT = {
				any_primary_culture = {
					has_discrimination_trait = arabic_heritage
				}
			}
			any_scope_pop = {
				culture = {
					has_discrimination_trait = arabic_heritage
				}
				pop_is_discriminated = yes
			}
		}
        every_scope_state = {
            limit = {
                any_scope_pop = {
					culture = {
						has_discrimination_trait = arabic_heritage
					}
					pop_is_discriminated = yes
				}
            }
            add_radicals_in_state = {
                value = medium_radicals
                culture = cu:mashriqi
            }
            add_radicals_in_state = {
                value = medium_radicals
                culture = cu:levantine
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:iraqi
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:bedouin
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:yemenite
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:hadramhi
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:omani
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:khaleeji
            }
			add_radicals_in_state = {
                value = medium_radicals
                culture = cu:misri
            }
        }
    }
	
	every_country = {
		limit = { 
			country_is_in_india = yes
			exists = c:PER
			is_subject_of = c:PER
		}
		every_scope_state = {
			set_variable = hindustani_subject_state
		}
    }
	
	random_market = {
		limit = {
			owner = c:PER
			any_trade_route = {
				goods = g:opium
				exporter.owner = c:PER
			}
		}
		every_trade_route = {
			limit = {
				goods = g:opium
				exporter.owner = c:PER
			}
			lock_trade_route = {
				years = 10
			}
		}
	}
}

