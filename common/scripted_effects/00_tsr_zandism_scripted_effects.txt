calculate_zandism_progress = {
	set_variable = { name = zandism_progress_var_next value = 0 }
	set_variable = { name = zandism_progress_from_radicals value = 0 }
	every_scope_state = {
		limit = {
			is_incorporated = yes
			state_region = {
				is_homeland = cu:persian
			}
			turmoil >= 0.10
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_radicals add = prev.turmoil }
		}
	}
	set_variable = { name = zandism_progress_from_loyalists value = 0 }
	every_scope_state = {
		limit = {
			is_incorporated = yes
			state_region = {
				is_homeland = cu:persian
			}
			loyalty >= 0.10
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_loyalists subtract = prev.loyalty }
		}
	}
	set_variable = { name = zandism_progress_from_unemployment value = 0 }
	every_scope_state = {
		limit = {
			is_incorporated = yes
			state_region = {
				is_homeland = cu:persian
			}
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_unemployment add = prev.state_unemployment_rate }
		}
	}
	set_variable = { name = zandism_progress_from_devout value = 0 }
	if = {
		limit = {
			ig:ig_devout = {
				OR = {
					is_marginal = yes
					has_ideology = ideology:ideology_persian_constitutionalist
					has_ideology = ideology:ideology_reformer
					has_ideology = ideology:ideology_bahai #in case you somehow made Bab ig leader
				}
			}
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_devout add = -10 }
		}
	}
	else_if = {
		limit = {
			ig:ig_devout = {
				ig_clout >= 0.1
			}
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_devout add = 3 }
		}
	}
	#From Poverty
	set_variable = { name = zandism_progress_from_poverty value = 0 }
	every_scope_state = {
		limit = {
			is_incorporated = yes
			state_region = {
				is_homeland = cu:persian
			}
		}
		set_variable = { name = temp_sol value = this.population_below_expected_sol } 
		change_variable = { name = temp_sol multiply = this.state_population }
		change_variable = { name = temp_sol divide = root.total_population }
		change_variable = { name = temp_sol multiply = 10 } # This variable equals the percentage of pops in incorporated states below expected SoL times ten. If 25% of your pops in incorporated states are below expected SoL, this will equal 2.5.
		ROOT = {
			change_variable = { name = zandism_progress_from_poverty add = prev.var:temp_sol }
		}
	}
	#From Characters
	set_variable = { name = zandism_progress_from_characters value = 0 }
	every_scope_character = {
		limit = {
			OR = {
				has_variable = mohammad_zand
				has_ideology = ideology:ideology_theocrat
				has_ideology = ideology:ideology_traditionalist
			}
		}
		ROOT = {
			change_variable = { name = zandism_progress_from_characters add = prev.popularity }
		}
	}
	change_variable = { name = zandism_progress_from_characters divide = 100 }
	# From Laws
	set_variable = { name = zandism_progress_from_laws value = 0 }
	# Cops
	set_variable = { name = temp_policing_var_contribution value = institution:institution_police.investment }
	if = {
		limit = {
			has_law = law_type:law_no_police
		}
		change_variable = { name = temp_policing_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_local_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_dedicated_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_militarized_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.5 }
	}
	
	# Internal Affairs
	set_variable = { name = temp_ha_var_contribution value = institution:institution_home_affairs.investment }
	if = {
		limit = {
			has_law = law_type:law_no_home_affairs
		}
		change_variable = { name = temp_ha_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_guaranteed_liberties
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_national_guard
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_secret_police
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.5 }
	}
	change_variable = { name = zandism_progress_from_laws add = var:temp_policing_var_contribution }
	change_variable = { name = zandism_progress_from_laws add = var:temp_ha_var_contribution }
	remove_variable = temp_policing_var_contribution
	remove_variable = temp_ha_var_contribution

	# Compilation
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_radicals }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_loyalists }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_unemployment }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_devout }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_poverty }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_characters }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_from_laws }
	change_variable = { name = zandism_progress_var_next add = var:zandism_progress_var_add }
}

add_zandism_progress = {
	change_variable = { name = zandism_je_var add = var:zandism_progress_var_next }
}

set_zandism_vars = {
	set_variable = { name = zandism_progress_from_radicals value = 0 }
	set_variable = { name = zandism_progress_from_loyalists value = 0 }
	set_variable = { name = zandism_progress_from_poverty value = 0 }
	set_variable = { name = zandism_progress_from_igs value = 0 }
	set_variable = { name = zandism_progress_from_characters value = 0 }
	set_variable = { name = zandism_progress_from_laws value = 0 }
	set_variable = { name = zandism_progress_var_add value = 0 }
}

clear_zandism_vars = {
	remove_variable = zandism_progress_var_next
	remove_variable = zandism_progress_from_radicals
	remove_variable = zandism_progress_from_loyalists
	remove_variable = zandism_progress_from_poverty
	remove_variable = zandism_progress_from_igs
	remove_variable = zandism_progress_from_characters
	remove_variable = zandism_progress_from_laws
	remove_variable = zandism_progress_var_add
}